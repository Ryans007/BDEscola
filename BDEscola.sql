/*Banco de Dados Para Escola*/

CREATE DATABASE BDEscola;

/* CRIANDO A TABELA PROFESSOR */
CREATE TABLE PROFESSOR(
     MATRICULA INT,
     NOME VARCHAR(30) NOT NULL,
	 SNOME VARCHAR(30) NOT NULL,
	 DATANASC DATE NOT NULL,
	 SEXO ENUM('F','M') NOT NULL,
	 SALARIO FLOAT(10,2) NOT NULL,
	 MATRIC_REPRESENT_AREA INT,
	 DEPTO INT NOT NULL
);
/* CONSTRAINTS DA TABELA PROFESSOR */
ALTER TABLE PROFESSOR ADD CONSTRAINT PK_PROFESSOR
PRIMARY KEY(MATRICULA);

ALTER TABLE PROFESSOR ADD CONSTRAINT PROFESSOR_PROFESSOR_FK
FOREIGN KEY(MATRIC_REPRESENT_AREA) REFERENCES PROFESSOR(MATRICULA);

ALTER TABLE PROFESSOR DROP FOREIGN KEY PROFESSOR_PROFESSOR; /* EXCLUI CONSTRAINT */

ALTER TABLE PROFESSOR ADD CONSTRAINT PROFESSOR_DEPARTAMENTO_FK
FOREIGN KEY(DEPTO) REFERENCES DEPARTAMENTO(CODIGO);

DESC PROFESSOR;

/* CRIANDO A TABELA DEPARTAMENTO */

CREATE TABLE DEPARTAMENTO(
     CODIGO INT,
     NOME VARCHAR(30) NOT NULL,
	 SIGLA ENUM('DTT','DCE','DEC') NOT NULL,
     COORDENADOR INT NOT NULL	 
);

/* CONSTRAINTS DA TABELA DEPARTAMENTO */

ALTER TABLE DEPARTAMENTO ADD CONSTRAINT PK_DEPARTAMENTO
PRIMARY KEY(CODIGO);

ALTER TABLE DEPARTAMENTO ADD CONSTRAINT DEPARTAMENTO_PROFESSOR_FK
FOREIGN KEY(COORDENADOR) REFERENCES PROFESSOR(MATRICULA);

/* CRIANDO A TABELA PROJETO */

CREATE TABLE PROJETO(
    CODIGO INT,
	NOME VARCHAR(30) NOT NULL,
	DURACAO VARCHAR(20) NOT NULL,
	DEPTO INT NOT NULL
);

/* CONSTRAINTS DA TABELA PROJETO */

ALTER TABLE PROJETO ADD CONSTRAINT PK_PROJETO
PRIMARY KEY(CODIGO);

ALTER TABLE PROJETO ADD CONSTRAINT PROJETO_DEPARTAMENTO_FK
FOREIGN KEY(DEPTO) REFERENCES DEPARTAMENTO(CODIGO);

/* CRIANDO A TABELA DEPENDENTE */

CREATE TABLE DEPENDENTE(
     RG INT,
	 NOME VARCHAR(30) NOT NULL,
	 SEXO ENUM('F','M') NOT NULL,
	 DATANASC DATE NOT NULL,
	 MATRICPROF INT NOT NULL
);

/* CONSTRAINTS DA TABELA DEPENDENTE */

ALTER TABLE DEPENDENTE ADD CONSTRAINT PK_DEPENDENTE
PRIMARY KEY(RG);

ALTER TABLE DEPENDENTE ADD CONSTRAINT DEPENDENTE_PROFESSOR_FK
FOREIGN KEY(MATRICPROF) REFERENCES PROFESSOR(MATRICULA);

/* CRIANDO A TABELA EMAIL */

CREATE TABLE EMAIL(
   MATRICPROF INT,
   EMAIL VARCHAR(100)
);

/* CONSTRAINTS DA TABELA EMAIL */

ALTER TABLE EMAIL ADD CONSTRAINT PK_EMAIL
PRIMARY KEY(MATRICPROF, EMAIL);

/* INSERINDO DADOS NA TABELA DEPARTAMENTO */

/* DESATIVANDO AS FOREIGN KEYS PARA FAZER A INSERÇÃO */

SET FOREIGN_KEY_CHECKS = 0;

/* INSERINDO NA TABELA DEPARTAMENTO */

INSERT INTO DEPARTAMENTO VALUES(121,'Tec. Telemática','DTT',121031);
INSERT INTO DEPARTAMENTO VALUES(122,'Tec Construção de Edifícios','DCE',122047);
INSERT INTO DEPARTAMENTO VALUES(125,'Eng. Computação','DEC',125331);

SELECT * FROM DEPARTAMENTO;

/* INSERINDO VALORES NA TABELA PROFESSOR */

INSERT INTO PROFESSOR MATRICULA, NOME, SNOME, DATANASC, SEXO, SALARIO, MATRIC_REPRESENT_AREA, DEPTO) 
VALUES(121003,'Pedro', 'Pereira da Silva', '1982-03-25', 'M', 4000, NULL, 121);

INSERT INTO PROFESSOR (MATRICULA, NOME, SNOME, DATANASC, SEXO, SALARIO, MATRIC_REPRESENT_AREA, DEPTO) 
VALUES (121031, 'José', 'Campos', '1978-04-10', 'M', 7000.00, 121003, 121);

INSERT INTO PROFESSOR (MATRICULA, NOME, SNOME, DATANASC, SEXO, SALARIO, MATRIC_REPRESENT_AREA, DEPTO) 
VALUES (122045, 'Bento Diniz', 'Costa', '1980-11-27', 'M', 4000.00, NULL, 122);

INSERT INTO PROFESSOR (MATRICULA, NOME, SNOME, DATANASC, SEXO, SALARIO, MATRIC_REPRESENT_AREA, DEPTO) 
VALUES (122047, 'Ana Clara', 'Araújo Santos', '1994-12-30', 'F', 7200.00, 122045, 122);

INSERT INTO PROFESSOR (MATRICULA, NOME, SNOME, DATANASC, SEXO, SALARIO, MATRIC_REPRESENT_AREA, DEPTO) 
VALUES (125332, 'Joana Maria', 'Campos Pereira', '1990-06-12', 'F', 4500.00, NULL, 125);

INSERT INTO PROFESSOR (MATRICULA, NOME, SNOME, DATANASC, SEXO, SALARIO, MATRIC_REPRESENT_AREA, DEPTO) 
VALUES (125335, 'João Carlos', 'Matos Cavalcanti', '1976-07-22', 'M', 3700.00, 125332, 125);

INSERT INTO PROFESSOR (MATRICULA, NOME, SNOME, DATANASC, SEXO, SALARIO, MATRIC_REPRESENT_AREA, DEPTO) 
VALUES (125331, 'Maria Luiza', 'Machado', '1974-08-16', 'F', 6800.00, 125332, 125);

INSERT INTO PROFESSOR (MATRICULA, NOME, SNOME, DATANASC, SEXO, SALARIO, MATRIC_REPRESENT_AREA, DEPTO) 
VALUES (126532, 'Iana', 'Daia', '1962-08-16', 'F', 12000.00, 125335, 125);


SELECT * FROM PROFESSOR;

/* ATIVANDO NOVAMENTE AS FOREIGN KEYS */

SET FOREIGN_KEY_CHECKS = 1;

/* INSERINDO NA TABELA PROJETO */

INSERT INTO PROJETO (CODIGO, NOME, DURACAO, DEPTO) 
VALUES (1001, 'Projeto A', '12 meses', 121);

INSERT INTO PROJETO (CODIGO, NOME, DURACAO, DEPTO) 
VALUES (1002, 'Projeto B', '6 meses', 122);

INSERT INTO PROJETO (CODIGO, NOME, DURACAO, DEPTO) 
VALUES (1003, 'Projeto C', '24 meses', 125);

INSERT INTO PROJETO (CODIGO, NOME, DURACAO, DEPTO) 
VALUES (1004, 'Projeto D', '18 meses', 121);

INSERT INTO PROJETO (CODIGO, NOME, DURACAO, DEPTO) 
VALUES (1005, 'Projeto E', '9 meses', 122);

INSERT INTO PROJETO (CODIGO, NOME, DURACAO, DEPTO) 
VALUES (1006, 'Aplicações BD', '10 meses', 122);

/* INSERINDO NA TABELA DEPENDENTE */

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (123456789, 'Lucas Silva', 'M', '2005-08-15', 121031);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (987654321, 'Mariana Oliveira', 'F', '2008-02-20', 122047);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (456123789, 'Ana Beatriz', 'F', '2010-05-25', 125332);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (321456987, 'Felipe Costa', 'M', '2012-12-01', 125335);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (789654123, 'Sofia Almeida', 'F', '2015-07-19', 125331);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (112233445, 'Carlos Souza', 'M', '2003-01-12', 121031);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (223344556, 'Fernanda Lima', 'F', '2007-06-25', 122047);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (334455667, 'Gabriel Martins', 'M', '2011-03-30', 125332);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (445566778, 'Juliana Costa', 'F', '2014-10-15', 125335);

INSERT INTO DEPENDENTE (RG, NOME, SEXO, DATANASC, MATRICPROF) 
VALUES (556677889, 'Roberto Almeida', 'M', '2017-09-05', 125331);


SELECT * FROM DEPENDENTE;

/* INSERINDO NA TABELA EMAIL */

INSERT INTO EMAIL (MATRICPROF, EMAIL) 
VALUES (121031, 'jose.campos@exemplo.com');

INSERT INTO EMAIL (MATRICPROF, EMAIL) 
VALUES (122045, 'bento.costa@exemplo.com');

INSERT INTO EMAIL (MATRICPROF, EMAIL) 
VALUES (122047, 'ana.santos@exemplo.com');

INSERT INTO EMAIL (MATRICPROF, EMAIL) 
VALUES (125332, 'joana.campos@exemplo.com');

INSERT INTO EMAIL (MATRICPROF, EMAIL) 
VALUES (125335, 'joao.cavalcanti@exemplo.com');

SELECT * FROM EMAIL;

/* CONSULTAS SQL */

/*1*/

SELECT NOME, 
       RG, 
	   DATANASC 
FROM DEPENDENTE
WHERE SEXO = 'F';

/*2*/

SELECT DISTINCT SALARIO FROM PROFESSOR
ORDER BY SALARIO DESC;

/*3*/

UPDATE PROJETO 
SET NOME = 'Aplicações de Big Data'
WHERE NOME = 'Aplicações BD';

/*4*/

SELECT MATRICULA, 
       NOME 
FROM PROFESSOR
WHERE YEAR(DATANASC) >= 1970
ORDER BY NOME ASC;

/*5*/

SELECT * FROM PROFESSOR
WHERE (YEAR(DATANASC) >= 1980 AND YEAR(DATANASC) < 1990)
AND SNOME LIKE "%Pereira%"
ORDER BY DATANASC ASC;

/*6*/

SELECT NOME, 
       SNOME, 
	   MATRICULA 
FROM PROFESSOR
WHERE MATRIC_REPRESENT_AREA IS NOT NULL;

/*7*/

SELECT NOME, 
       MAX(DATANASC) AS "DATA DE NASCIMENTO" 
FROM DEPENDENTE
ORDER BY DATANASC;

/*8*/

SELECT MATRICULA, 
       NOME 
FROM PROFESSOR
WHERE NOME LIKE "%MARIA%" AND SEXO = 'F'
ORDER BY NOME DESC;

/*9*/

SELECT NOME, SNOME 
FROM PROFESSOR
WHERE NOME LIKE "_O%" AND SNOME LIKE "%CAMPOS%";

/*10*/

SELECT 
    D.CODIGO, 
	D.NOME, 
	COUNT(DEPTO) AS QUANTIDADE 
FROM DEPARTAMENTO D 
INNER JOIN PROJETO P 
ON D.CODIGO = P.DEPTO
GROUP BY DEPTO;

/*11*/

SELECT 
     D.CODIGO,
     D.NOME,	 
	 COUNT(DEPTO)
FROM PROFESSOR P 
INNER JOIN DEPARTAMENTO D
ON P.DEPTO = D.CODIGO
GROUP BY DEPTO
HAVING COUNT(DEPTO) > 2;

/*12*/

SELECT P.NOME,
       P.SNOME, 
	   P.MATRICULA 
FROM PROFESSOR P 
INNER JOIN DEPARTAMENTO D 
ON P.DEPTO = D.CODIGO 
WHERE DEPTO = 121;

/*13*/

SELECT E.EMAIL 
FROM PROFESSOR P 
INNER JOIN EMAIL E
ON E.MATRICPROF = P.MATRICULA
WHERE NOME = 'João Carlos'; 

/*14*/

SELECT NOME 
FROM PROFESSOR
WHERE MATRICULA = (SELECT COORDENADOR FROM DEPARTAMENTO
WHERE NOME = 'Eng. Computação');

/*15*/

SELECT NOME 
FROM PROFESSOR 
WHERE MATRICULA NOT IN(SELECT MATRICPROF FROM DEPENDENTE);







